# topmark:header:start
#
#   file         : tox.ini
#   file_relpath : tox.ini
#   project      : TopMark
#   license      : MIT
#   copyright    : (c) 2025 Olivier Biot
#
# topmark:header:end

[tox]
min_version = 4.0
env_list =
    py310, py311, py312, py313,
    py310-typecheck, py311-typecheck, py312-typecheck, py313-typecheck,
        py310-api, py311-api, py312-api, py313-api

isolated_build = true            # respects PEP 517/518 if you use them

[testenv]
package = skip # Do not build packages in test environments
usedevelop = true                # Use the source tree directly, no egg-link
deps = -r requirements-dev.txt   # pytest, mypy â€¦ already in there
commands =
    pytest -q tests

# --- per-Python Pyright envs ---
[testenv:py310-typecheck]
description = Run pyright type checks on Python 3.10
basepython = python3.10
usedevelop = true
deps = pyright
commands = pyright

[testenv:py311-typecheck]
description = Run pyright type checks on Python 3.11
basepython = python3.11
usedevelop = true
deps = pyright
commands = pyright

[testenv:py312-typecheck]
description = Run pyright type checks on Python 3.12
basepython = python3.12
usedevelop = true
deps = pyright
commands = pyright

[testenv:py313-typecheck]
description = Run pyright type checks on Python 3.13
basepython = python3.13
usedevelop = true
deps = pyright
commands = pyright

# --- API snapshot check per Python version ---
[testenv:py310-api]
description = Run only the API snapshot test on Python 3.10
basepython = python3.10
deps = -r requirements-dev.txt
commands = pytest -vv tests/api/test_public_api_snapshot.py

[testenv:py311-api]
description = Run only the API snapshot test on Python 3.11
basepython = python3.11
deps = -r requirements-dev.txt
commands = pytest -vv tests/api/test_public_api_snapshot.py

[testenv:py312-api]
description = Run only the API snapshot test on Python 3.12
basepython = python3.12
deps = -r requirements-dev.txt
commands = pytest -vv tests/api/test_public_api_snapshot.py

[testenv:py313-api]
description = Run only the API snapshot test on Python 3.13
basepython = python3.13
deps = -r requirements-dev.txt
commands = pytest -vv tests/api/test_public_api_snapshot.py