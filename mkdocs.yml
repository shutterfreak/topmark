# topmark:header:start
#
#   project      : TopMark
#   file         : mkdocs.yml
#   file_relpath : mkdocs.yml
#   license      : MIT
#   copyright    : (c) 2025 Olivier Biot
#
# topmark:header:end

# --- Build Behavior ---

# Force the build to fail if there are any broken internal links or configuration errors.
# Essential for CI/CD to ensure documentation quality.
strict: true
validation:
  links:
    # Ensures absolute links (starting with /) are treated as relative to the docs root,
    # preventing broken links when hosted on subpaths like ReadTheDocs.
    absolute_links: relative_to_docs

# --- Project Metadata ---

site_name: TopMark
site_description: A tool to inspect, validate, and manage file headers in codebases.
site_author: Olivier Biot
copyright: "Copyright &copy; 2025 Olivier Biot. Licensed under the MIT license."
site_url: https://topmark.readthedocs.io/
repo_name: shutterfreak/topmark
repo_url: https://github.com/shutterfreak/topmark
edit_uri: edit/main/docs/

# --- Content Filtering ---

# Snippets are partial files included via 'include-markdown'; they shouldn't be rendered as standalone pages.
exclude_docs: |
  _snippets/*
  _snippets/**

# Folders for content still under construction.
draft_docs: |
  _drafts/

theme:
  name: material
  language: en
  logo: assets/topmark-logo.png
  favicon: assets/favicon.ico
  features:
    # Loads pages via AJAX for a smoother, faster experience:
    - navigation.instant
    # Groups navigation items into sections for better hierarchy:
    - navigation.sections
    # Adds a 'copy to clipboard' button to all code blocks:
    - content.code.copy
    # Shows completion suggestions in the search bar:
    - search.suggest
    # Highlights search terms on the target page:
    - search.highlight
    # Adds a 'back to top' button:
    - navigation.top
    # Updates the URL fragment as the user scrolls:
    - navigation.tracking

markdown_extensions:
  # Enables Markdown processing inside raw HTML blocks (e.g. <div markdown="1">).
  - md_in_html

  # Table of Contents configuration.
  - toc:
      permalink: true # Adds clickable anchor links next to every header

  # Standard Admonitions (!!! note)
  - admonition

  # Collapsible blocks (??? note)
  - pymdownx.details

  # Allows adding classes to elements, e.g., {: .api-symbol }
  - attr_list

  # Enables definition lists (Term : Definition)
  - def_list

  # High-level control over code blocks and diagrams.
  - pymdownx.superfences:
      custom_fences:
        # Mermaid.js integration: intercepts ```mermaid blocks and renders diagrams.
        - name: mermaid
          class: mermaid
          format: !!python/name:pymdownx.superfences.fence_code_format

        - name: flow
          class: highlight
          format: !!python/name:pymdownx.superfences.fence_code_format

  - pymdownx.highlight:
      anchor_linenums: true
      line_spans: __span
      pygments_lang_class: true

  # Material icon shortcodes like :material-folder: / :material-file:
  - pymdownx.emoji:
      emoji_generator: !!python/name:material.extensions.emoji.to_svg
      emoji_index: !!python/name:material.extensions.emoji.twemoji

plugins:
  # 1) Search engine plugin - usually listed early in the sequence.
  - search

  # 2) Programmatic page generation (e.g. API reference from source code).
  - gen-files:
      scripts:
        - tools/docs/gen_api_pages.py

  # 3) Generates sidebar navigation from a Markdown SUMMARY.md file (used for generated internals pages).
  - literate-nav

  # 4) Allows including external Markdown files into pages.
  - include-markdown:
      rewrite_relative_urls: true

  # 5) Automatic API documentation from Python docstrings.
  # Note: mkdocstrings handles 'autorefs' internally; separate declaration often causes schema errors.
  - mkdocstrings:
      default_handler: python
      handlers:
        python:
          paths: ["src"]
          options:
            docstring_style: google
            show_signature: true
            separate_signature: true
            show_source: true
            show_root_heading: true
            members_order: source
            inherited_members: false
            show_if_no_docstring: false
            merge_init_into_class: true
            filters:
              # hide “private” members
              - "!^_"
              # hide dunder members like __init__
              - "!^__"

  # 6) Provides lifecycle hooks to run custom Python logic during the build.
  - mkdocs-simple-hooks:
      hooks:
        # Setup tasks (e.g. version loading):
        on_pre_build: "tools.docs.hooks:pre_build"
        # Regex/text replacements on pages:
        # Note: the 'on_page_markdown' hook is the correct place to
        # transform GitHub style '> [!NOTE]' into '!!! note' automatically.
        on_page_markdown: "tools.docs.hooks:on_page_markdown"
        # Cleanup or reporting:
        on_post_build: "tools.docs.hooks:post_build"

nav:
  - Home: index.md
  - Installation: install.md
  - Usage:
      - Global options: usage/global-options.md
      - Commands:
          - "check": usage/commands/check.md
          - "strip": usage/commands/strip.md
          - "config": usage/commands/config.md
          - "config check": usage/commands/config_check.md
          - "config dump": usage/commands/config_dump.md
          - "config defaults": usage/commands/config_defaults.md
          - "config init": usage/commands/config_init.md
          - "filetypes": usage/commands/filetypes.md
          - "processors": usage/commands/processors.md
          - "version": usage/commands/version.md
      - Guides:
          - "Supported file types (generated)": usage/generated-filetypes.md
          - "Supported header processors (generated)": usage/generated-processors.md
          - "Filtering recipes": usage/filtering.md
          - "Header placement": usage/header-placement.md
          - "Pre-commit": usage/pre-commit.md
  - Configuration:
      - Overview: configuration/index.md
      - Discovery & Precedence: configuration/discovery.md
  - CI/CD:
      - CI workflow: ci/ci-workflow.md
      - Release workflow: ci/release-workflow.md
      - Dev validation: ci/dev-validation.md
  - Contributing: contributing.md
  - API:
      - "Public API": api/public.md
      - "topmark.api": api/reference/topmark.api.md
      - "topmark.registry": api/reference/topmark.registry.md
      - "Internals":
          - Overview: api/internals.md
          - "Reference (generated)": api/internals/
  - Development:
      - "Architecture": dev/architecture.md
      - "Config schema": dev/config-schema.md
      - "Pipelines (concepts)": dev/pipelines.md
      - "Pipelines (reference hub)": dev/pipelines-reference.md
      - "API Stability": dev/api-stability.md
      - "Machine output": dev/machine-output.md
      - "Machine formats": dev/machine-formats.md
      - "Documentation Pipeline & Reference Hygiene": dev/documentation-pipeline.md
      - "Roadmap": dev/roadmap.md

# --- Development Server ---

# Directories to monitor for live-reloading during 'mkdocs serve'.
watch:
  - src
  - docs

# Custom JS to inject into the footer (e.g. for dynamic banners).
extra_javascript:
  - assets/version-warning.js
